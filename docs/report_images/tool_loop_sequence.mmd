%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4a90d9', 'primaryTextColor': '#fff', 'lineColor': '#5a6f85'}}}%%
sequenceDiagram
    participant User as User
    participant Agent as SlackAgent
    participant Hooks as Hooks
    participant LLM as LLM
    participant Tools as ToolExecutor
    participant Brain as ChromaDB/Web

    User->>Agent: Message received
    Agent->>Hooks: Pre-process: intent_classifier_hook()
    Hooks-->>Agent: Intent: RESEARCH
    
    Agent->>LLM: Generate (tools available)
    LLM-->>Agent: tool_use: web_search("React hooks")
    
    Agent->>Tools: Execute tool
    Tools->>Brain: Fetch results
    Brain-->>Tools: Snippets + URLs
    Tools->>Tools: Record sources to tracker
    Tools-->>Agent: ToolResult
    
    Agent->>LLM: Tool context + original question
    LLM-->>Agent: Final answer text
    
    Agent->>Hooks: Post-process: citation_hook()
    Hooks->>Hooks: Format    Hooks->>Hooks: Format    Hooks->>Hooks: Format    Hooks->>Hooks: Format    Hooks->>Hooksesponse with citations
